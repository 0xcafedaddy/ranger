{
  "serviceName":"hdfsdev",

  "serviceDef":{
    "name":"hdfs",
    "id":1,
    "resources":[
    {"name":"path","type":"path","level":1,"mandatory":true,"lookupSupported":true,"matcher":"org.apache.ranger.plugin.resourcematcher.RangerPathResourceMatcher","matcherOptions":{"wildCard":true, "ignoreCase":true},"label":"Resource Path","description":"HDFS file or directory path"}
    ],
    "accessTypes":[
      {"name":"read","label":"Read"},
      {"name":"write","label":"Write"},
      {"name":"execute","label":"Execute"}
    ]
  },

  "policies":[
    {"id":1,"name":"audit-all-access under /finance/restricted/","isEnabled":true,"isAuditEnabled":true,
     "resources":{"path":{"values":["/finance/restricted/"],"isRecursive":true}},
     "policyItems":[
       {"accesses":[],"users":[],"groups":["public"],"delegateAdmin":false}
     ]
    }
    ,
    {"id":2,"name":"allow-read-to-all under /public/","isEnabled":true,"isAuditEnabled":false,
     "resources":{"path":{"values":["/public/*"],"isRecursive":true}},
     "policyItems":[
       {"accesses":[{"type":"read","isAllowed":true},{"type":"execute","isAllowed":true}],"users":[],"groups":["public"],"delegateAdmin":false}
     ]
    }
    ,
    {"id":3,"name":"allow-read-to-finance under /finance/restricted","isEnabled":true,"isAuditEnabled":true,
     "resources":{"path":{"values":["/finance/restricted"],"isRecursive":true}},
     "policyItems":[
       {"accesses":[{"type":"read","isAllowed":true}],"users":[],"groups":["finance"],"delegateAdmin":false}
     ]
    }
  ],
  "tagPolicyInfo": {

    "serviceName":"tagdev",
    "serviceDef": {
      "name": "_tag_",
      "id": 101,
      "resources": [
        {
          "itemId": 1,
          "name": "tag",
          "type": "string",
          "level": 1,
          "parent": "",
          "mandatory": true,
          "lookupSupported": true,
          "recursiveSupported": false,
          "excludesSupported": false,
          "matcher": "org.apache.ranger.plugin.resourcematcher.RangerDefaultResourceMatcher",
          "matcherOptions": {
            "wildCard": true,
            "ignoreCase": false
          },
          "validationRegEx": "",
          "validationMessage": "",
          "uiHint": "",
          "label": "TAG",
          "description": "TAG"
        }
      ],
      "accessTypes": [
        {
          "itemId": 1,
          "name": "hdfs:read",
          "label": "hdfs:Read"
        },
        {
          "itemId": 2,
          "name": "hdfs:write",
          "label": "hdfs:Write"
        },
        {
          "itemId": 3,
          "name": "hdfs:execute",
          "label": "hdfs:Execute"
        }
        ,
        {
          "itemId": 4,
          "name": "hive:grant",
          "label": "hive:grant"
        }
        ,
        {
          "itemId": 5,
          "name": "kms:dek",
          "label": "kms:dek"
        }
        ,
        {
          "itemId": 6,
          "name": "delete",
          "label": "delete"
        }
      ],
      "contextEnrichers": [
        {
          "itemId": 1,
          "name" : "TagEnricher",
          "enricher" : "org.apache.ranger.plugin.contextenricher.RangerTagProvider",
          "enricherOptions" : {"TagProviderType":"FILESTORE_BASED_TAG_PROVIDER", "pollingInterval":30000, "dataFile":"/etc/ranger/data/resourceTags.txt"}
        }
      ],
      "policyConditions": [
        {
          "itemId":1,
          "name":"ScriptConditionEvaluator",
          "evaluator": "org.apache.ranger.plugin.conditionevaluator.RangerScriptConditionEvaluator",
          "evaluatorOptions" : {"engineName":"JavaScript"},
          "label":"Script",
          "description": "Script to execute"
        }
      ]
    },
    "tagPolicies":[
      {"id":5,"name":"allow somethingelse tag","isEnabled":true,"isAuditEnabled":true,"policyType":0,
        "resources":{"tag":{"values":["pii"],"isRecursive":false}},
        "policyItems":[
          {"accesses":[{"type":"hdfs:read", "isAllowed":true}, {"type":"hive:grant", "isAllowed":true}, {"type":"delete", "isAllowed":true}, {"type":":write", "isAllowed":true}],"users":["user1"],"groups":["finance"],"delegateAdmin":false,
          "conditions" : [{"type":"ScriptConditionEvaluator", "values": [
            "importPackage(java.util); var accessDate = ctx.getAsDate(ctx.accessTime); var expiryDate =ctx.getTagAttributeAsDate('pii','expiry'); expiryDate.getTime() < accessDate.getTime();"
            ,
            "importPackage(java.util); var accessTime = ctx.accessTime; print('accessTime=' + accessTime); var accessDate = ctx.getAsDate(accessTime); println('accessDate=' + accessDate); var currentDate = new Date(); println('currentDate=' + currentDate); println('current=' +currentDate.getTime()); println('access='+ accessDate.getTime()); result = true;"
            ,
            "importPackage(java.util); var accessTime = ctx.accessTime; var currentTime = Date(); print('accessTime=' + accessTime); println('currentTime=' + currentTime); accessTime.after(currentTime)"
            ,
            "var ownerUser = request.resource.getOwnerUser(); println('ownerUser=' + ownerUser); result = true;"
            ,
            "var ownerUser = request.resource.ownerUser; println('ownerUser=' + ownerUser); result = true;"
            ,
            "var tagName = ctx.currentTagName; println('tagName=' + tagName); ctx.result = true;"
            ,
            "var resource = ctx.get('RESOURCE').getAsMap(); println('resource path=' + resource.get('path')); result = true;"

          ]
                          }]
          }
        ]
      }
      ,
      {"id":4,"name":"allow partial-match tag","isEnabled":true,"isAuditEnabled":true,
        "resources":{"tag":{"values":["restr*"],"isRecursive":false}},
        "policyItems":[
          {"accesses":[{"type":"hdfs:write","isAllowed":true}],"users":["user1"],"groups":["finance"],"delegateAdmin":false}
        ]
      }
      ,
      {"id":3,"name":"restricted tags","isEnabled":true,"isAuditEnabled":true,"policyType":0,
        "resources":{"tag":{"values":["res*"],"isRecursive":false}},
        "policyItems":[
          {"accesses":[{"type":"hdfs:write","isAllowed":true}],"users":["user1"],"groups":["finance"],"delegateAdmin":false}
        ]
      }
    ]
  },
  "tests":[
    {"name":"ALLOW 'read /finance/restricted/sales.db' for g=finance",
     "request":{
      "resource":{"elements":{"path":"/finance/restricted/sales.db"}},
      "accessType":"read","user":"user1","userGroups":["finance"],"requestData":"read /finance/restricted/sales.db"
     },
     "result":{"isAudited":true,"isAllowed":true,"policyId":3}
    }
    ,
    {"name":"ALLOW 'read /finance/restricted/hr/payroll.db' for g=finance",
     "request":{
      "resource":{"elements":{"path":"/finance/restricted/hr/payroll.db"}},
      "accessType":"read","user":"user1","userGroups":["finance"],"requestData":"read /finance/restricted/hr/payroll.db"
     },
     "result":{"isAudited":true,"isAllowed":true,"policyId":3}
    }
    ,
    {"name":"DENY 'read /operations/visitors.db' for g=finance",
     "request":{
      "resource":{"elements":{"path":"/operations/visitors.db"}},
      "accessType":"read","user":"user1","userGroups":["finance"],"requestData":"read /operations/visitors.db"
     },
     "result":{"isAudited":false,"isAllowed":false,"policyId":-1}
    }
    ,
    {"name":"ALLOW 'read /public/technology/blogs.db' for g=finance",
     "request":{
      "resource":{"elements":{"path":"/public/technology/blogs.db"}},
      "accessType":"read","user":"user1","userGroups":["finance"],"requestData":"read /public/technology/blogs.db"
     },
     "result":{"isAudited":false,"isAllowed":true,"policyId":2}
    }
    ,

    {"name":"DENY 'read /finance/restricted/sales.db' for g=hr",
     "request":{
      "resource":{"elements":{"path":"/finance/restricted/sales.db"}},
      "accessType":"read","user":"user1","userGroups":["hr"],"requestData":"read /finance/restricted/sales.db"
     },
     "result":{"isAudited":true,"isAllowed":false,"policyId":-1}
    }
    ,
    {"name":"FALSE 'read /finance/restricted/hr/payroll.db' for g=hr",
     "request":{
      "resource":{"elements":{"path":"/finance/restricted/hr/payroll.db"}},
      "accessType":"read","user":"user1","userGroups":["hr"],"requestData":"read /finance/restricted/hr/payroll.db"
     },
     "result":{"isAudited":true,"isAllowed":false,"policyId":-1}
    }
    ,
    {"name":"DENY 'read /operations/visitors.db' for g=hr",
     "request":{
      "resource":{"elements":{"path":"/operations/visitors.db"}},
      "accessType":"read","user":"user1","userGroups":["hr"],"requestData":"read /operations/visitors.db"
     },
     "result":{"isAudited":false,"isAllowed":false,"policyId":-1}
    }
    ,
    {"name":"ALLOW 'read /public/technology/blogs.db' for g=hr",
     "request":{
      "resource":{"elements":{"path":"/public/technology/blogs.db"}},
      "accessType":"read","user":"user1","userGroups":["hr"],"requestData":"read /public/technology/blogs.db"
     },
     "result":{"isAudited":false,"isAllowed":true,"policyId":2}
    }
    ,

    {"name":"DENY 'read /finance/restricted/sales.db' for u=user1",
     "request":{
      "resource":{"elements":{"path":"/finance/restricted/sales.db"}},
      "accessType":"read","user":"user1","userGroups":[],"requestData":"read /finance/restricted/sales.db"
     },
     "result":{"isAudited":true,"isAllowed":false,"policyId":-1}
    }
    ,
    {"name":"DENY 'read /finance/restricted/hr/payroll.db' for u=user1",
     "request":{
      "resource":{"elements":{"path":"/finance/restricted/hr/payroll.db"}},
      "accessType":"read","user":"user1","userGroups":[],"requestData":"read /finance/restricted/hr/payroll.db"
     },
     "result":{"isAudited":true,"isAllowed":false,"policyId":-1}
    }
    ,
    {"name":"DENY 'read /operations/visitors.db' for u=user1",
     "request":{
      "resource":{"elements":{"path":"/operations/visitors.db"}},
      "accessType":"read","user":"user1","userGroups":[],"requestData":"read /operations/visitors.db"
     },
     "result":{"isAudited":false,"isAllowed":false,"policyId":-1}
    }
    ,
    {"name":"ALLOW 'read /public/technology/blogs.db' for u=user1",
     "request":{
      "resource":{"elements":{"path":"/public/technology/blogs.db"}},
      "accessType":"read","user":"user1","userGroups":[],"requestData":"read /public/technology/blogs.db"
     },
     "result":{"isAudited":false,"isAllowed":true,"policyId":2}
    }
    ,
    {"name":"ALLOW 'read /public/technology' for u=user1",
     "request":{
      "resource":{"elements":{"path":"/public/technology/blogs.db"}},
      "accessType":"read","user":"user1","userGroups":[],"requestData":"read /public/technology/blogs.db"
     },
     "result":{"isAudited":false,"isAllowed":true,"policyId":2}
    }
    ,
    {"name":"ALLOW 'read /public/technology' for u=user1",
     "request":{
      "resource":{"elements":{"path":"/public/technology/blogs.db"}},
      "accessType":"execute","user":"user1","userGroups":[],"requestData":"read /public/technology/blogs.db"
     },
     "result":{"isAudited":false,"isAllowed":true,"policyId":2}
    }
  ]
}

